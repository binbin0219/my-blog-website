<%- include('./partials/header', { title: 'Home' }) %>
<%- include('./components/post')  %>
<%- include('./partials/navBar') %>

<!-- Croppie.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.css">

<style>
    body {
        font-family: 'Calibri', sans-serif;
    }

    #section_buttons_container .active {
        border-bottom-width: 4px;
        color: black;
    }

    @media(max-width: 630px) {
        #section_buttons_container {
            display: none;
        }
        #section_buttons_container.mobile {
            display: flex;
        }

        .background-footer {
            display: none;
            justify-content: end;
        }

        .user-background {
            border-radius: 0;
            border: 0;
        }

        .background-image {
            border-radius: 0;
        }

        .background-user {
            /* align-items: end; */
            margin-bottom: 5px;
        }
        .background-user .profile-image {
            transform: translateY(0);
            width: 75px;
            height: 75px;
        }
        .background-user .user-name {
            transform: translateY(0);
            font-size: 20px;
        }

        .background-header {
            border-bottom: 0;
        }

    }
</style>

<!-- content -->
<div 
class="
    flex flex-col mt-[65px]
    md:max-w-[800px] md:w-full md:mx-auto md:items-center md:justify-center
">
    <div class="user-background w-full rounded-b-lg relative border">
        <img id="cover_preview" style="object-fit: cover;" class="background-image w-full h-auto max-h-[400px] rounded-b-lg" src="<%= typeof profile_user.profile_cover === 'string' ? profile_user.profile_cover : "https://images.pexels.com/photos/281260/pexels-photo-281260.jpeg?cs=srgb&dl=pexels-francesco-ungaro-281260.jpg&fm=jpg" %>" alt="">
        <div class="absolute top-0 left-0 w-full h-full bg-black/[0.2] flex flex-col justify-end">
            <div class="background-header w-full flex items-end justify-between px-2 relative border-b-2">
                <div class="background-user flex gap-5 items-center">
                    <img src="<%= profile_user.avatar %>" class="profile-image w-[100px] h-[100px] rounded-full translate-y-[40px]" alt="">
                    <p class="user-name text-white font-bold text-2xl items-center translate-y-[25px]"><%= profile_user.username %> <%= profile_user.user_id === user.user_id ? '(You)' : '' %></p>
                </div>
                <% if (profile_user.user_id === user.user_id) { %>
                    <label id="edit_cover_btn" for="edit_cover_input" class="border-black border-2 px-3 py-2 rounded-lg bg-black bg-opacity-50 text-white mb-1 hover:bg-black hover:bg-opacity-100">
                        <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-camera inline">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2" />
                            <path d="M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                        </svg>
                        Edit Cover
                    </label>
                    <input type="file" accept="image/jpeg, image/png" name="edit_cover_input" id="edit_cover_input" class="hidden">
                <% } else { %>
                    <!-- <button type="button" 
                    class="
                    bg-red-200 border-red-400 text-red-600 hover:bg-red-300 border-2 px-3 py-2 rounded-lg mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-exclamation inline">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4c.348 0 .686 .045 1.008 .128" />
                            <path d="M19 16v3" />
                            <path d="M19 22v.01" />
                        </svg>
                        Friend Request Rejected
                    </button> -->
                    <button id="unsend_request_button" type="button" 
                    class="
                    <%= profile_user.friendship && (profile_user.friendship.status === 'pending' && profile_user.friendship.sender_id == user.user_id) ? '' : 'hidden' %> 
                    bg-green-200 border-green-400 text-green-600 hover:bg-green-300 border-2 px-3 py-2 rounded-lg mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-check inline">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4" />
                            <path d="M15 19l2 2l4 -4" />
                        </svg>
                        Friend Request Sent
                    </button>
                    <div id="reply_friend_request" 
                    class="
                    <%= profile_user.friendship && (profile_user.friendship.status === 'pending' && profile_user.friendship.sender_id !== user.user_id) ? '' : 'hidden' %> 
                    dropdown">
                        <button type="button" class="dropdown-toggle bg-cyan-200 border-cyan-400 text-cyan-600 hover:bg-cyan-300 border-2 px-3 py-2 rounded-lg mb-1">
                            Reply Friend Request
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                            class="icon icon-tabler icons-tabler-outline icon-tabler-caret-down inline">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M6 10l6 6l6 -6h-12" />
                            </svg>
                        </button>
                        <div class="dropdown-menu">
                            <ul class="dropdown-content">
                                <li class="dropdown-item">
                                    <button id="accept_request_button" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-check inline">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4" />
                                            <path d="M15 19l2 2l4 -4" />
                                        </svg>
                                        Accept
                                    </button>
                                </li>
                                <li class="dropdown-item">
                                    <button id="reject_request_button" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-x inline">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h3.5" />
                                            <path d="M22 22l-5 -5" />
                                            <path d="M17 22l5 -5" />
                                        </svg>
                                        Reject
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <button id="unfriend_button" type="button" class="
                    <%= profile_user.friendship && profile_user.friendship.status === 'accepted' ? '' : 'hidden' %> 
                    bg-red-200 border-red-400 text-red-600 hover:bg-red-300 border-2 px-3 py-2 rounded-lg mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-x inline">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h3.5" />
                            <path d="M22 22l-5 -5" />
                            <path d="M17 22l5 -5" />
                        </svg>
                        Unfriend
                    </button>
                    <button id="add_friend_button" type="button" class="
                    <%= typeof profile_user.friendship === 'undefined' || profile_user.friendship.status === 'rejected' ? '' : 'hidden' %>
                    bg-sky-200 border-sky-400 text-sky-600 hover:bg-sky-300 border-2 px-3 py-2 rounded-lg mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-plus inline">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                            <path d="M16 19h6" />
                            <path d="M19 16v6" />
                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4" />
                        </svg>
                        Add Friend
                    </button>
                <% } %>
            </div>
            <div class="w-full bg-white background-footer">
                <div id="section_buttons_container" class="section-buttons-container flex gap-2 h-full w-fit mx-auto">
                    <button data-data-loaded="true" data-profile-section="posts_section" type="button" class="profile-section-toggle active h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
                        <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-inbox me-2">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
                            <path d="M4 13h3l3 3h4l3 -3h3" />
                        </svg>
                        Posts
                    </button>
                    <button data-data-loaded="true" data-profile-section="about_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
                        <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-id me-2">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v10a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z" />
                            <path d="M9 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                            <path d="M15 8l2 0" />
                            <path d="M15 12l2 0" />
                            <path d="M7 16l10 0" />
                        </svg>
                        About
                    </button>
                    <button data-data-loaded="false" data-profile-section="friends_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
                        <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-users me-2">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                            <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                            <path d="M21 21v-2a4 4 0 0 0 -3 -3.85" />
                        </svg>
                        Friends
                    </button>
                    <button disabled data-data-loaded="false" data-profile-section="photos_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4 cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-alert-triangle me-2">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M12 9v4" />
                            <path d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z" />
                            <path d="M12 16h.01" />
                        </svg>
                        Photos
                    </button>
                </div>
            </div>
        </div>
    </div> 
    <div id="section_buttons_container" class="section-buttons-container mobile flex gap-2 h-full w-full justify-center hidden">
        <button data-data-loaded="true" data-profile-section="posts_section" type="button" class="profile-section-toggle active h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
            <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-inbox me-2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
                <path d="M4 13h3l3 3h4l3 -3h3" />
            </svg>
            Posts
        </button>
        <button data-data-loaded="true" data-profile-section="about_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
            <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-id me-2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M3 4m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v10a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z" />
                <path d="M9 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                <path d="M15 8l2 0" />
                <path d="M15 12l2 0" />
                <path d="M7 16l10 0" />
            </svg>
            About
        </button>
        <button data-data-loaded="false" data-profile-section="friends_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4">
            <svg style="pointer-events: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-users me-2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />
                <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                <path d="M21 21v-2a4 4 0 0 0 -3 -3.85" />
            </svg>
            Friends
        </button>
        <button disabled data-data-loaded="false" data-profile-section="photos_section" type="button" class="profile-section-toggle h-full p-3 font-bold flex items-center text-slate-400 border-sky-400 hover:text-black hover:border-b-4 cursor-not-allowed">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-alert-triangle me-2">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 9v4" />
                <path d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z" />
                <path d="M12 16h.01" />
            </svg>
            Photos
        </button>
    </div>
    <div id="profile_sections" class="w-full px-2">
        <div id="posts_section" class="w-full mt-4 gap-8 flex flex-col">
            <div id="no_posts_yet" class="w-full flex flex-col items-center mt-10 gap-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes-off">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M7 3h10a2 2 0 0 1 2 2v10m0 4a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-14" />
                    <path d="M11 7h4" />
                    <path d="M9 11h2" />
                    <path d="M9 15h4" />
                    <path d="M3 3l18 18" />
                </svg>
                <h1 class="text-2xl font-bold text-center text-gray-500">No posts yet</h1>
            </div>
        </div>
        <div id="about_section" class="w-full mt-4 gap-8 flex flex-col hidden">
            <div class="w-full flex flex-col rounded-lg border items-center">
                <h1 class="p-4 font-bold text-2xl border-b w-full">About</h1>
                <div class="border-b flex gap-3 w-[95%] p-4">
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-signature">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M3 17c3.333 -3.333 5 -6 5 -8c0 -3 -1 -3 -2 -3s-2.032 1.085 -2 3c.034 2.048 1.658 4.877 2.5 6c1.5 2 2.5 2.5 3.5 1l2 -3c.333 2.667 1.333 4 3 4c.53 0 2.639 -2 3 -2c.517 0 1.517 .667 3 2" />
                            </svg>
                        </div> 
                        <div class="flex flex-col">
                            <h4 class="font-bold">Name</h4>
                            <h6 class="text-sm"><%= profile_user.first_name %> <%= profile_user.last_name %></h6>
                        </div>
                    </div>
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-gender-male">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M10 14m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0" />
                                <path d="M19 5l-5.4 5.4" />
                                <path d="M19 5h-5" />
                                <path d="M19 5v5" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="font-bold">Gender</h4>
                            <h6 class="text-sm"><%= profile_user.gender %></h6>
                        </div>
                    </div>
                </div>
                <div class="border-b flex gap-3 w-[95%] p-4">
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                                <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="font-bold">Location</h4>
                            <% if (profile_user.country === null) { %>
                                <h6 class="text-sm">Unkown</h6>
                            <% } else { %>
                                <h6 class="text-sm">From <%= profile_user.country %><%= profile_user.region !== null ? `, ${profile_user.region}` : '' %></h6>
                            <% }%>
                        </div>
                    </div>
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-heart">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M19.5 12.572l-7.5 7.428l-7.5 -7.428a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="font-bold">Relationship</h4>
                            <% if (profile_user.relationship_status === null) { %>
                                <h6 class="text-sm">Unkown</h6>
                            <% } else { %>
                                <h6 class="text-sm"><%= profile_user.relationship_status %></h6>
                            <% }%>
                        </div>
                    </div>
                </div>
                <div class="border-b flex gap-3 w-[95%] p-4">
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-briefcase">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M3 7m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z" />
                                <path d="M8 7v-2a2 2 0 0 1 2 -2h4a2 2 0 0 1 2 2v2" />
                                <path d="M12 12l0 .01" />
                                <path d="M3 13a20 20 0 0 0 18 0" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="font-bold">Occupation</h4>
                            <% if (profile_user.relationship_status === null) { %>
                                <h6 class="text-sm">Unkown</h6>
                            <% } else { %>
                                <h6 class="text-sm"><%= profile_user.occupation %></h6>
                            <% }%>
                        </div>
                    </div>
                    <div class="flex gap-3 w-[50%]">
                        <div class="w-[45px] h-[45px] border rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-mobile">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                <path d="M6 5a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2v-14z" />
                                <path d="M11 4h2" />
                                <path d="M12 17v.01" />
                            </svg>
                        </div>
                        <div class="flex flex-col">
                            <h4 class="font-bold">Phone Number</h4>
                            <% if (profile_user.phone_number === null) { %>
                                <h6 class="text-sm">Unkown</h6>
                            <% } else { %>
                                <h6 class="text-sm">+(<%- profile_user.phone_number && profile_user.phone_number.dialCode %>) <%- profile_user.phone_number && profile_user.phone_number.phoneNumberBody %></h6>
                            <% }%>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="friends_section" class="w-full mt-4 flex flex-col hidden relative border rounded-lg">
            <h5 class="font-bold text-2xl p-3 border-b">Friends</h5>
        </div>
        <div id="photos_section" class="w-full mt-4 gap-8 flex flex-col hidden">
    
        </div>
    </div>
</div>

<script>
    const relatedUsers = <%- JSON.stringify(related_users) %>;
    const profileUser = <%- JSON.stringify(profile_user) %>;

    document.addEventListener('DOMContentLoaded', () => {
        const postList = document.getElementById('posts_section');
        if(postList && postData.length > 0) {
            postData.forEach(post => createPostElement(post, 'posts_section'));
        }
    })

    const edit_cover_input = document.getElementById('edit_cover_input');
    edit_cover_input && edit_cover_input.addEventListener('input', () => {

        const maxSizeInBytes = 2 * 1024 * 1024;
        if(edit_cover_input.files && edit_cover_input.files[0].size > maxSizeInBytes) {
            showToast('error', 'Error', 'Cover image size must be less than 2MB.');
            return;
        }

        confDialog(
            'Crop your cover', 
            `<div class="w-full flex justify-center">
                <div id="avatar_croppie"></div>
            </div>`, 
            'Confirm', 
            async () => {
                const coverPreview = document.querySelector('#cover_preview');
                const resultCover = await coverCroppie.result('base64', 'viewport', 'png', true);
                fetch('/api/profile-cover-image/store', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cover_base64: resultCover
                    })
                })
                .then(res => {
                    if(res.ok) {
                        return res.json();
                    }
                    showToast('error', 'Error', 'Something went wrong.');
                    confDialog();
                    throw new Error('Failed to save cover image');
                })
                .then(data => {
                    coverPreview.src = resultCover;
                    coverCroppie.destroy();
                    showToast('success', 'Success', 'Your cover image has been updated.');
                    confDialog();
                })
                .catch(error => {
                    console.error(error);
                    showToast('error', 'Error', 'Something went wrong.');
                    confDialog();
                })

            }
        );

        // Croppie.js initialization
        const coverCroppieContainer = document.querySelector('#avatar_croppie');
        const coverCroppie = new Croppie(coverCroppieContainer, {
            enableOrientation: true,
            viewport: {
                width: 400,
                height: 200,
                type: 'square'
            },
            boundary: {
                width: 500,
                height: 500
            }
        });

        coverCroppie.bind({
            url: URL.createObjectURL(edit_cover_input.files[0])
        });
    })

    const section_buttons_container = document.querySelectorAll('.section-buttons-container');
    section_buttons_container && section_buttons_container.forEach(container => {
        container.addEventListener('click', e => {
            if(!e.target.classList.contains('profile-section-toggle')) return;
            const clickedButton = e.target;
            const selectedSectionId = clickedButton.getAttribute('data-profile-section');
            const activeButton = container.querySelector('.active');
            const activeSectionId = activeButton.getAttribute('data-profile-section');
            if(activeSectionId == selectedSectionId) return;
            
            // Hide current section
            const activeSection = document.getElementById(activeSectionId);
            activeSection.classList.add('hidden');
            section_buttons_container.forEach(container => {
                container.querySelector('.active').classList.remove('active');
            })

            // Show selected section
            const selectedSection = document.getElementById(selectedSectionId);
            selectedSection.classList.remove('hidden');
            section_buttons_container.forEach(container => {
                container.querySelector(`.profile-section-toggle[data-profile-section=${clickedButton.getAttribute('data-profile-section')}]`).classList.add('active');
            })

            // Load data
            const isDataLoaded = clickedButton.getAttribute('data-data-loaded');
            if(isDataLoaded == 'false') {
                switch(selectedSectionId) {
                    case 'friends_section':
                        const loader = getLoaderElement({
                            position: 'relative',
                            marginTop: 'mt-[100px]',
                            marginBottom: 'mb-[100px]'
                        });
                        selectedSection.appendChild(loader);

                        setTimeout(() => {
                            fetch(`/api/friends/${profileUser.user_id}`)
                            .then(res => {
                                if(!res.ok) {
                                    throw new Error('Failed to get friends');
                                }
                                return res.json();
                            })
                            .then(data => {
                                selectedSection.removeChild(loader);

                                if(data.friends.length == 0) {
                                    const no_friends_message = document.createElement('div');
                                    no_friends_message.className = 'w-full h-full flex flex-col justify-center items-center p-5';
                                    no_friends_message.innerHTML = `
                                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-exclamation inline">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4c.348 0 .686 .045 1.008 .128" />
                                            <path d="M19 16v3" />
                                            <path d="M19 22v.01" />
                                        </svg>
                                        <h1 class="font-bold text-2xl">No friends</h1>
                                    `;
                                    selectedSection.appendChild(no_friends_message);
                                } else {
                                    data.friends.forEach(friend => {
                                        const friendElement = createFriendElement(friend);
                                        selectedSection.appendChild(friendElement);
                                    })
                                }

                                clickedButton.setAttribute('data-data-loaded', 'true');
                            })
                            .catch(err => {
                                console.error(err);
                            })
                        }, 500);
                        break;
                    default:
                        break;
                }
            }
        })
    })

    // Add friend
    const addFriendButton = document.getElementById('add_friend_button');
    addFriendButton && addFriendButton.addEventListener('click', () => {
        const friend_id = <%= profile_user.user_id %>;
        const user_id = <%= user.user_id %>;
        fetch('/api/friend-request/send/' + friend_id)
        .then(res => {
            if(!res.ok) {
                throw new Error('Failed to send friend request');
            }
            return res.json();
        })
        .then(data => {
            addFriendButton.classList.add('hidden');
            document.getElementById('unsend_request_button')?.classList.remove('hidden');
        })
        
    })

    // Unfriend
    const unfriendButton = document.getElementById('unfriend_button');
    unfriendButton && unfriendButton.addEventListener('click', () => {
        confDialog(
            'Remove Friend', 
            'Are you sure you want to unfriend this user?', 
            'Unfriend', 
            () => {
                const friend_id = <%= profile_user.user_id %>;
                fetch('/api/friendship/delete/' + friend_id)
                .then(res => {
                    if(!res.ok) {
                        throw new Error('Failed to unfriend');
                    }
                    return res.json();
                })
                .then(data => {
                    unfriendButton.classList.add('hidden');
                    document.getElementById('add_friend_button')?.classList.remove('hidden');
                    confDialog();
                })
                .catch(err => {
                    console.log(err);
                    showToast('error', 'Error', 'Something went wrong.');
                    confDialog();
                })
            }
        )
    })

    // Accept friend request
    const accept_request_button = document.getElementById('accept_request_button');
    accept_request_button && accept_request_button.addEventListener('click', async () => {
        try {
            await acceptFriendRequest(<%= profile_user.user_id %>);
            document.getElementById('reply_friend_request').classList.add('hidden');
            document.getElementById('unfriend_button').classList.remove('hidden');

            // Remove notification
            const friendRequestNotification = userData.notifications.find(notification => notification.type === 'friend_request' && notification.sender_id === profileUser.user_id);
            friendRequestNotification && deleteNotifitcationElement(friendRequestNotification.notification_id)
        } catch(err) {
            console.log(err);
            showToast('error', 'Error', 'Something went wrong.');
        }
    })

    // Reject friend request
    const reject_request_button = document.getElementById('reject_request_button');
    reject_request_button && reject_request_button.addEventListener('click', async () => {
        try {
            await rejectFriendRequest(<%= profile_user.user_id %>);
            document.getElementById('reply_friend_request').classList.add('hidden');
            document.getElementById('add_friend_button').classList.remove('hidden');

            // Remove notification
            const friendRequestNotification = userData.notifications.find(notification => notification.type === 'friend_request' && notification.sender_id === profileUser.user_id);
            friendRequestNotification && deleteNotifitcationElement(friendRequestNotification.notification_id)
        } catch(err) {
            console.log(err);
            showToast('error', 'Error', 'Something went wrong.');
        }
    })

    // Unsend friend request
    const unsend_request_button = document.getElementById('unsend_request_button');
    unsend_request_button && unsend_request_button.addEventListener('click', async () => {
        confDialog(
            'Unsend Friend Request', 
            'Are you sure you want to unsend this friend request?', 
            'Unsend', 
            async () => {
                try {
                    await unsendFriendRequest(<%= profile_user.user_id %>);
                    unsend_request_button.classList.add('hidden');
                    document.getElementById('add_friend_button').classList.remove('hidden');
                    confDialog();
                } catch(err) {
                    console.log(err);
                    showToast('error', 'Error', 'Something went wrong.');
                    confDialog();
                }
            }
        )
    })

    function createFriendElement(friend) {
        const friendElement = document.createElement('div');
        friendElement.className = 'flex items-center p-5 hover:bg-gray-100 cursor-pointer w-full border-b';
        friendElement.innerHTML = `
        <a href="/user/profile/${friend.user_id}" class="flex gap-3">
            <div class="w-[50px] h-[50px] rounded-full overflow-hidden">
                <img src="${friend.avatar}" alt="">
            </div>
            <div class="flex flex-col">
                <h1 class="font-bold hover:underline">${friend.username}</h1>
                <h1 class="text-gray-500">${friend.first_name} ${friend.last_name}</h1>
            </div>
        </a>
        `;
        return friendElement;
    }
</script>

<%- include('./partials/footer') %>